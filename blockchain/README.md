# Общая теория блокчейна

- [Что такое блокчейн](#%D1%87%D1%82%D0%BE-%D1%82%D0%B0%D0%BA%D0%BE%D0%B5-%D0%B1%D0%BB%D0%BE%D0%BA%D1%87%D0%B5%D0%B9%D0%BD)
- [Как подключиться к блокчейну?](#%D0%BA%D0%B0%D0%BA-%D0%BF%D0%BE%D0%B4%D0%BA%D0%BB%D1%8E%D1%87%D0%B8%D1%82%D1%8C%D1%81%D1%8F-%D0%BA-%D0%B1%D0%BB%D0%BE%D0%BA%D1%87%D0%B5%D0%B9%D0%BD%D1%83)
- [Из чего состоит блок?](#%D0%B8%D0%B7-%D1%87%D0%B5%D0%B3%D0%BE-%D1%81%D0%BE%D1%81%D1%82%D0%BE%D0%B8%D1%82-%D0%B1%D0%BB%D0%BE%D0%BA)
- [Как считается хэш блока?](#%D0%BA%D0%B0%D0%BA-%D1%81%D1%87%D0%B8%D1%82%D0%B0%D0%B5%D1%82%D1%81%D1%8F-%D1%85%D1%8D%D1%88-%D0%B1%D0%BB%D0%BE%D0%BA%D0%B0)
- [Как майнятся блоки?](#%D0%BA%D0%B0%D0%BA-%D0%BC%D0%B0%D0%B9%D0%BD%D1%8F%D1%82%D1%81%D1%8F-%D0%B1%D0%BB%D0%BE%D0%BA%D0%B8)
- [Валидация, вознаграждение, консенсус](#%D0%B2%D0%B0%D0%BB%D0%B8%D0%B4%D0%B0%D1%86%D0%B8%D1%8F-%D0%B2%D0%BE%D0%B7%D0%BD%D0%B0%D0%B3%D1%80%D0%B0%D0%B6%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5-%D0%BA%D0%BE%D0%BD%D1%81%D0%B5%D0%BD%D1%81%D1%83%D1%81)
- [Майнинг на примере Proof Of Work](#%D0%BC%D0%B0%D0%B9%D0%BD%D0%B8%D0%BD%D0%B3-%D0%BD%D0%B0-%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D1%80%D0%B5-proof-of-work)
- [Что почитать для более глубокого понимания?](#%D1%87%D1%82%D0%BE-%D0%BF%D0%BE%D1%87%D0%B8%D1%82%D0%B0%D1%82%D1%8C-%D0%B4%D0%BB%D1%8F-%D0%B1%D0%BE%D0%BB%D0%B5%D0%B5-%D0%B3%D0%BB%D1%83%D0%B1%D0%BE%D0%BA%D0%BE%D0%B3%D0%BE-%D0%BF%D0%BE%D0%BD%D0%B8%D0%BC%D0%B0%D0%BD%D0%B8%D1%8F)

## Что такое блокчейн?

> Плэйграунд, который поможет понять, как работает блокчейн https://andersbrownworth.com/blockchain/. Там же есть
видео, объясняющее принципы.

**Блокчейн** -- это система хранения информации в блоках таким образом, что каждый новый блок ссылается 
на предыдущий блок. У каждого блока есть свой хэш, соответствующий хранимой в нём информации, в которую входит хэш предыдущего блока.

При этом, блоки хранятся децентрализовано, и этот механизм делает невозможным подделать блок из прошлого, не
подменив все следующие блоки у всех участников сети.

Нулевой блок называется **genesis** и не имеет ссылки на предыдущий блок.

> [[ Пример с блоками ]](https://andersbrownworth.com/blockchain/blockchain) - в этом примере изменение данных в 
> каком-либо блоке приведёт к тому, что у него изменится хэш, и все следующие блоки перестанут быть валидными.

## Как подключиться к блокчейну?

Чтобы подключиться к блокчейну, нужно подключиться к ноде. Нода блокчейна -- это программа, которая хранит полную
историю блоков (иногда её часть, но сейчас не об этом), обменивается информацией с другими нодами, отправляет транзакции
и создаёт (майнит) новые блоки за вознаграждение.

Ноду можно завести самому, использовать Infura.io или ноды, предоставляемые вашим кошельком, вроде Metamask. Последний,
фактически, обеспечивает пользователю и разработчику свой интерфейс для общения со своими нодами.

## Из чего состоит блок?

Фактически, блок состоит из набора записей (транзакций) об изменении какой-либо информации, хранимой
в блокчейне. Обычно это изменение состояния счетов пользователей.

> [[ Демонстрация принципа работы блока ]](https://andersbrownworth.com/blockchain/coinbase)

## Как считается хэш блока?

Хэш блока считается следующим образом: 

- Считается хэш каждой транзакции. 
- Все хэши транзакций в блоке делятся попарно. Если транзакций нечётное количество, 
хэш последней транзакции объединяется на время рассчёта с самим собой.
- Считается хэш для каждой пары хэшей транзакций
- Процесс повторяется, но уже для хэшей пар, а не транзакций, пока не считается общий хэш

> [[ Подробнее про это в википедии ]](https://ru.wikipedia.org/wiki/%D0%94%D0%B5%D1%80%D0%B5%D0%B2%D0%BE_%D1%85%D0%B5%D1%88%D0%B5%D0%B9)

## Как майнятся блоки

- Пользователь создаёт транзакцию и подписывает её от своего имени. При этом, в блоке может и не быть транзакций, он всё 
  равно будет смайнен, содержа только информацию о предыдущем блоке. 
- Пользователь, кроме указанной для перевода суммы, выбирает величину комиссии за проведение транзакции. Майнеры 
  заинтересованы в том, чтобы получить транзакции с более высокой комиссией, поэтому чем больше комиссия, тем быстрее
  транзакция попадёт в блок.
- Пользователь отправляет транзакцию выбранной им ноде блокчейна
- Нода получает информацию о транзакции и рассылает её остальным нодам
- Транзакции записываются в создающийся блок, и получают хэш
- Каждая нода пытается создать (майнит) блок и разослать его остальным участникам
- Остальные участники, получая блок, валидируют его, и приступают к процессу заново
- Владелец ноды, создавшей валидный блок, получает все комиссии за транзакции на свой счёт 

## Валидация, вознаграждение, консенсус

Ноды, которые занимаются майнингом, должны быть заинтересованы в том, чтобы создать новый блок, записать его и 
разослать всем остальным участникам сети. Ноды, занимающеся майнингом, должны получать вознаграждение за свою
работу. 

Так как пользователь сам может указывать величину комиссии, которую хочет заплатить за майнинг блока, майнеры могут 
выбирать, какие транзакции помещать в блок раньше других, выбирая транзакции с большей комиссией. Транзакции с низкой
комиссией при этом остаются в очереди, уступая даже новым поступающим транзакциям, с более высокой комиссией.

Существует несколько способов решить, кто получит вознаграждение, они называются консенсусом:

#### Proof of Work (PoW)

При этом типе консенсуса награду получает та нода, которая быстрее всех решила задачу. Для этого она должна обладать
наибольшим набором мощностей, чтобы сделать это быстрее остальных. 

Способ вреден для экологии, требует покупки дорогостоящего железа, поэтому сейчас от него отходят.

#### Proof of Stake (PoS)

При этом типе консенсуса для валидации блока участники процесса вкладывают (стэйкают) свои средства в монеты сети. Каждый 
валидатор получает вознаграждение за валидацию приходящих ему блоков. А блоки распределяются между валидаторами с 
вероятностью, зависящей от количества монет на счету валидатора. Больше монет -- больше блоков -- больше вознаграждение. 

Этот способ хорош всем, кроме опасности централизации.

#### Delegated Proof of Stake (DPoS)

Вариант proof of stake, только в нём участники сети вкладывают (стейкают) свои средства на счёт выбранного ими 
валидатора. А валидатор, в свою очередь, получает вознаграждение за валидацию блоков, и распределяет его между 
своими вкладчиками, пропорционально их вкладам

## Майнинг на примере Proof Of Work

В данном примере мы рассмотрим тип консенсуса, называем Proof Of Work (или доказательство работы).

В нём каждый участник процесса должен первым решить задачу определённой сложности, чтобы получить деньги за создание
блока.

> [[ Пример с кнопкой Mine ]](https://andersbrownworth.com/blockchain/block) - в этом примере критерием валидности блока 
является наличие 4 нулей в начале его хэша. Задача вычисления значения **nonce**, при
котором хэш для **data** будет содержать 4 нуля в начале и есть указанная выше задача.

В рамках приведённого примера, количество нулей в начале хэша - это регулируемая сложность задачи, которая задаётся
в зависимости от количества участников сети, и подбираемая так, чтобы блок майнился определённое время. Для **bitcoin** 
это время - 10 минут.

Первая нода, вычислившая нужный хэш, и разославшая информацию о нём другим нодам, и получает все комиссии за транзакции 
в этом блоке.

## Что почитать для более глубокого понимания?

### Цикл статей на хабре

Более подробное объяснение работы блокчейна, нацеленное на новичков, с примерами. Читаются по порядку, являются одним 
циклом:

- [Криптография в блокчейне](https://habr.com/ru/post/319868/)
- [Транзакции](https://habrahabr.ru/ru/post/319860/)
- [Протокол блокчейна](https://habrahabr.ru/ru/post/319862/)
- [Сам блокчейн, дерево меркля, содержимое блоков](https://habr.com/ru/post/320176/)
- [Майнинг](https://habr.com/ru/post/320178/)

### Прочие полезные статьи, которые используют наши блокчейнисты

- [Основная вики отдела блокчейна](https://git.sfxdx.ru/learning/blockchain/-/wikis/home)
- [Консенсус. Что такое Алгоритм Консенсуса в Blockchain?](https://academy.binance.com/ru/articles/what-is-a-blockchain-consensus-algorithm)
- [Обзор актуальных протоколов достижения консенсуса в децентрализованной среде](https://habr.com/ru/company/distributedlab/blog/419185/)
- [Разбираемся с форматами токенов на Ethereum](https://habr.com/ru/post/512476/)
- [Межпланетная файловая система IPFS](https://habr.com/ru/post/314768/)
- [Как запускать ноду](https://docs.cosmos.network/master/run-node/run-node.html)
- [VRF - Псевдослучайный генератор последовательности](https://hackernoon.com/generating-randomness-in-blockchain-verifiable-random-function-ft1534ud)
- [ERC-721 Non-Fungible Token Standard (NFT) - информация по 721 стандарту](https://ethereum.org/en/developers/docs/standards/tokens/erc-721/)
